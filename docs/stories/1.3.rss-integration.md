# Story 1.3: RSS Feed Integration

## Status
Draft

## Story
**As a** user,
**I want** to subscribe to RSS feeds (like Substack, Medium) and see them in my dashboard,
**so that** I can aggregate newsletter content from RSS-enabled sources alongside email sources.

## Acceptance Criteria
1. User can add RSS feed URLs through the settings interface
2. System validates RSS feed URLs before adding them as sources
3. RSS feeds are polled regularly for new content
4. New RSS items are parsed and stored as newsletter items
5. System respects ETag/Last-Modified headers for efficient polling
6. RSS content is deduplicated against existing items
7. Failed RSS feeds are marked with error status and retry logic
8. User can view, edit, and remove RSS feed sources
9. System handles various RSS/Atom feed formats

## Tasks / Subtasks
- [ ] Create RSS feed management interface (AC: 1, 8)
  - [ ] Add RSS URL input form to settings
  - [ ] Build RSS source list component
  - [ ] Implement edit/remove RSS source functionality
  - [ ] Add RSS source status indicators
- [ ] Implement RSS feed validation (AC: 2, 9)
  - [ ] Create RSS URL validation service
  - [ ] Fetch and parse feed to verify format
  - [ ] Support both RSS and Atom feed formats
  - [ ] Extract feed metadata (title, description, link)
- [ ] Build RSS polling system (AC: 3, 5, 7)
  - [ ] Create scheduled background job for RSS polling
  - [ ] Implement ETag/Last-Modified caching
  - [ ] Add exponential backoff for failed feeds
  - [ ] Store polling metadata and error states
- [ ] Develop RSS content parser (AC: 4, 6)
  - [ ] Parse RSS/Atom item elements
  - [ ] Extract content, title, link, publication date
  - [ ] Clean and normalize RSS content
  - [ ] Generate content hash for deduplication
- [ ] Integrate with existing systems (AC: 4, 6)
  - [ ] Store RSS items using existing Items model
  - [ ] Link RSS items to RSS source records
  - [ ] Run through deduplication pipeline
  - [ ] Apply same normalization as email content
- [ ] Add RSS-specific error handling (AC: 7)
  - [ ] Handle invalid XML/malformed feeds
  - [ ] Manage network timeouts and failures
  - [ ] Log RSS processing errors
  - [ ] Implement retry logic with backoff

## Dev Notes

### Previous Story Insights
From Story 1.1 (OAuth Integration):
- Database models for Users, Sources established
- API patterns for source management (`POST /sources`)
- Rate limiting and error handling patterns

From Story 1.2 (Email Forwarding):
- Background job processing patterns
- Content parsing and normalization workflows
- Deduplication integration established

### Data Models
From architecture documents:
- **Sources**: Track RSS feeds with URL, polling metadata [Source: architecture/data-model-simplified.md]
- **Items**: Store parsed RSS content [Source: architecture/data-model-simplified.md]
- **Jobs**: Track RSS polling status [Source: architecture/data-model-simplified.md]
- Indexes on source_id, normalized_hash for efficient queries [Source: architecture/data-model-simplified.md]

### API Specifications
From architecture documents:
- `POST /sources` - Add RSS feed as source [Source: architecture/api-examples.md]
- `GET /feed` - Display RSS items in main feed [Source: architecture/api-examples.md]
- RSS polling extends ingestion layer patterns [Source: architecture/core-components.md]

### Component Specifications
From architecture documents:
- **Ingestion Layer**: RSS polling with ETag/Last-Modified [Source: architecture/ingestion-strategies.md]
- **Parsing/Normalization**: Extract main text, canonicalize links [Source: architecture/core-components.md]
- **Background Jobs**: Queue-based workers for RSS polling [Source: architecture/core-components.md]
- **Web App (React/Tailwind)**: Settings interface for RSS management [Source: architecture/core-components.md]

### File Locations
Based on established patterns from previous stories:
- **RSS service**: `/src/services/rss/` (parser.js, validator.js, poller.js)
- **RSS routes**: `/src/routes/sources.js` (extend existing source endpoints)
- **Background workers**: `/src/workers/rssPoller.js`
- **Database models**: Extend `/src/models/Source.js` with RSS-specific fields
- **Frontend components**: `/src/components/settings/RSSManager.jsx`
- **RSS utilities**: `/src/utils/rss/` (feedParser.js, contentExtractor.js)

### Technical Constraints
From architecture documents:
- **Ingestion**: RSS polling with ETag/Last-Modified [Source: architecture/ingestion-strategies.md]
- **Parsing**: Extract main text, canonicalize links [Source: architecture/parsing-normalization.md]
- **Performance**: Process feeds efficiently with caching [Source: architecture/performance-scaling.md]
- **Deduplication**: Generate hash + fingerprint for dedupe [Source: architecture/deduplication.md]

### Testing Strategy
**Testing Framework Requirements:**
- **Backend Testing**: Jest + Supertest for RSS endpoints
- **RSS Testing**: Mock RSS feeds for integration testing
- **Worker Testing**: Test polling jobs with queue mocks
- **Frontend Testing**: Jest + React Testing Library for RSS management UI

**Required Test Coverage:**
- **Unit Tests**: RSS parsing, validation, polling logic
- **Integration Tests**: End-to-end RSS subscription and polling
- **Component Tests**: RSS management interface
- **Performance Tests**: Polling efficiency and caching

**Specific Test Scenarios:**
- Successful RSS feed subscription and parsing
- ETag/Last-Modified caching behavior
- Handling malformed RSS feeds
- RSS content deduplication
- Polling retry logic on failures
- RSS source management UI operations
- Network timeout handling
- Various RSS/Atom feed formats

**Test File Locations:**
- **RSS service tests**: `/src/services/rss/__tests__/`
- **Worker tests**: `/src/workers/__tests__/rssPoller.test.js`
- **Frontend component tests**: `/src/components/settings/__tests__/RSSManager.test.jsx`
- **Integration tests**: `/tests/integration/rss-flow.test.js`

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-09 | 1.0 | Initial story creation with comprehensive testing guidance | Sarah (PO) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

## QA Results
*Results from QA Agent review will be populated here*