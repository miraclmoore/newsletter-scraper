# Story 1.8: Account Management & User Settings

## Status
Draft

## Story
**As a** user,
**I want** to sign up via email or Google and manage my connected sources in settings,
**so that** I can control my account, preferences, and newsletter sources in one place.

## Acceptance Criteria
1. User can sign up with email and password
2. User can sign up/sign in with Google OAuth
3. User can access a comprehensive settings/profile page
4. User can view and manage all connected sources (Gmail, Outlook, RSS, Forwarding)
5. User can update their profile information and preferences
6. User can change their password (for email accounts)
7. User can delete their account and all associated data
8. User can manage AI summary preferences and usage limits
9. System implements proper session management and security

## Tasks / Subtasks
- [ ] Implement user registration system (AC: 1, 2)
  - [ ] Create email/password registration form
  - [ ] Add Google OAuth registration option
  - [ ] Implement email verification for new accounts
  - [ ] Add password strength validation
- [ ] Build authentication system (AC: 2, 9)
  - [ ] Create login endpoints for email and Google OAuth
  - [ ] Implement JWT token management
  - [ ] Add session timeout and refresh logic
  - [ ] Create logout functionality
- [ ] Develop settings page layout (AC: 3, 5)
  - [ ] Create main settings page component
  - [ ] Add navigation tabs/sections for different settings
  - [ ] Implement responsive design for settings interface
  - [ ] Add breadcrumb navigation
- [ ] Create source management interface (AC: 4)
  - [ ] Display all connected sources with status
  - [ ] Add disconnect/remove source functionality
  - [ ] Show last sync time and source statistics
  - [ ] Implement source troubleshooting tools
- [ ] Build profile management (AC: 5, 6)
  - [ ] Create profile information form
  - [ ] Add change password functionality
  - [ ] Implement email address update with verification
  - [ ] Add timezone and notification preferences
- [ ] Implement account deletion (AC: 7)
  - [ ] Create account deletion confirmation flow
  - [ ] Implement complete data deletion (GDPR compliance)
  - [ ] Add data export before deletion option
  - [ ] Remove all connected OAuth tokens and sources
- [ ] Add AI preferences management (AC: 8)
  - [ ] Create AI summary toggle settings
  - [ ] Display current usage and limits
  - [ ] Add billing/upgrade options for limits
  - [ ] Show AI processing history
- [ ] Create authentication middleware (AC: 9)
  - [ ] Add route protection for authenticated users
  - [ ] Implement role-based access control
  - [ ] Add rate limiting for auth endpoints
  - [ ] Create password reset functionality

## Dev Notes

### Previous Story Insights
From Stories 1.1-1.7:
- OAuth integration patterns established for Gmail/Outlook
- Database models for Users, Sources ready for management
- AI summarization preferences need user control
- Export functionality requires user authentication

### Data Models
From architecture documents:
- **Users**: Store account info, preferences, settings [Source: architecture/data-model-simplified.md]
- **OAuth credentials**: Manage connected account tokens [Source: architecture/data-model-simplified.md]
- **Sources**: Track all user's newsletter sources [Source: architecture/data-model-simplified.md]
- User session and authentication data [Source: architecture/security-compliance.md]

### API Specifications
From architecture documents:
- User authentication extends existing API patterns [Source: architecture/core-components.md]
- Settings endpoints for managing user preferences
- Account management extends CRUD operations [Source: architecture/core-components.md]

### Component Specifications
From architecture documents:
- **Web App (React/Tailwind)**: Auth flows and settings interface [Source: architecture/core-components.md]
- **API (Node/Express)**: User management and authentication [Source: architecture/core-components.md]
- **Security**: OAuth least-privilege, encrypted storage [Source: architecture/security-compliance.md]

### File Locations
Based on established patterns:
- **Authentication routes**: `/src/routes/auth.js` (extend existing)
- **User routes**: `/src/routes/users.js`
- **Auth services**: `/src/services/auth/` (registration.js, login.js, oauth.js)
- **User models**: `/src/models/User.js` (extend existing)
- **Auth middleware**: `/src/middleware/auth.js`
- **Frontend pages**: `/src/pages/` (Login.jsx, Register.jsx, Settings.jsx)
- **Settings components**: `/src/components/settings/` (Profile.jsx, Sources.jsx, Security.jsx)

### Technical Constraints
From architecture documents:
- **Security**: OAuth least-privilege, encrypted tokens [Source: architecture/security-compliance.md]
- **Compliance**: GDPR-style deletion capabilities [Source: architecture/security-compliance.md]
- **Rate Limiting**: Per-user and per-IP limits [Source: architecture/security-compliance.md]
- **Authentication**: Secure session management [Source: architecture/core-components.md]

### Testing Strategy
**Testing Framework Requirements:**
- **Backend Testing**: Jest + Supertest for auth and user endpoints
- **Security Testing**: Test authentication flows and session management
- **Frontend Testing**: Jest + React Testing Library for auth and settings UI
- **Integration Testing**: End-to-end user registration and management flows

**Required Test Coverage:**
- **Unit Tests**: Authentication logic, user management, password validation
- **Integration Tests**: Complete registration and login workflows
- **Security Tests**: Session management, password security, data deletion
- **Component Tests**: Auth forms, settings interface, source management

**Specific Test Scenarios:**
- User registration with email verification
- Google OAuth registration and login flow
- Password change and reset functionality
- Source management (connect, disconnect, view status)
- Account deletion with complete data removal
- AI preferences management and usage tracking
- Session timeout and token refresh
- Settings page navigation and updates
- Profile information management
- Security features (rate limiting, session protection)

**Test File Locations:**
- **Auth service tests**: `/src/services/auth/__tests__/`
- **User route tests**: `/src/routes/__tests__/users.test.js`
- **Auth middleware tests**: `/src/middleware/__tests__/auth.test.js`
- **Frontend component tests**: `/src/components/settings/__tests__/`
- **Integration tests**: `/tests/integration/user-management.test.js`
- **Security tests**: `/tests/security/auth-security.test.js`

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-09 | 1.0 | Initial story creation with comprehensive testing guidance | Sarah (PO) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

## QA Results
*Results from QA Agent review will be populated here*